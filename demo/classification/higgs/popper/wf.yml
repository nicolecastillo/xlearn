steps:
- id: build-img
  uses: docker://docker:19.03.10
  args:
  - build
  -   --tag=xlearn
  -   --file=demo/classification/higgs/popper/docker/Dockerfile
  -   .

- id: download-data
  uses: docker://byrnedo/alpine-curl:0.1.8
  runs: [sh]
  dir: demo/classification/higgs/
  args:
  - -c
  - |
    set -ex
    if [ ! -f HIGGS.csv ]; then
      curl -LO https://archive.ics.uci.edu/ml/machine-learning-databases/00280/HIGGS.csv.gz
      if [ -f HIGGS.csv.gz ]; then
        gunzip HIGGS.csv.gz
      fi
    fi

- id: prepare-data
  uses: docker://xlearn
  # TODO - create an image for csv2libsvm
  # uses: docker://getpopper/csv2libsvm:ef2a6d4
  skip_pull: true
  runs: [csv2libsvm]
  args: 'demo/classification/higgs/popper/HIGGS.csv'

- id: run-benchmark
  uses: docker://xlearn
  skip_pull: true
  runs: ['bash']
  dir: demo/classification/higgs/popper/
  args: [run_benchmark.sh]

- id: show-results
  uses: docker://jupyter/scipy-notebook:latest
  runs: ['python3', './scripts/show_results.py']
